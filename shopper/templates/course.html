{% extends "base.html" %}
{% block navbar %}
<nav id="navbar-browse" class="navbar navbar-light bg-clear">
  <div class="row" id="navbar-main">
    <div class="col-md-2 text-center">
      <div class="navbar-col-content"><a class="navbar-brand" href="/browse" target="_self">TigerShop</a></div>
    </div>
    <div class="col-md-7 text-center">
      <div class="navbar-col-content">
        <form class="form-inline">
          <select class="search-options">
            <option value="0">Any</option>
            <option value="1">Department Code</option>
            <option value="2">Distribution</option>
            <option value="3">Start Time</option>
            <option value="4">End Time</option>
          </select>
          <select class="resizing-search-select">
            <option class="resizing-search-option"></option>
          </select>
          <input class="search-text-field" type="text" placeholder="search courses"></input>
          <button class="btn btn-primary search-button"><i class="fa fa-search" aria-hidden="true"></i></button>
        </form>
      </div>
    </div>
    <div class="col-md-3"></div>
  </div>
  <div class="row" id="navbar-footer">
    <div class="col-md-4">
      <div class="nav-section">
        <div class="nav">
          <a href="#" class="nav-link" target="_self">Departments</a>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="nav-section">
        <div class="nav">
          <a href="#" class="nav-link" target="_self">Distributions</a>
          <a href="#" class="nav-link" target="_self">Easy PDFs</a>
          <a href="#" class="nav-link" target="_self">GPA Boosters</a>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="nav-section">
        <div class="nav justify-content-end">
          <a class="nav-link" style="cursor: default;" id="account-greeting">Hi, {{ netid }}</a>
          <a href="#" class="nav-link" id="nav-account" class="btn nav-button">Your Account</a>
          <a href="/cart" class="nav-link btn nav-button" id="cart-button" target="_self">
            <i class="fa fa-shopping-cart fa-lg fa-2x" aria-hidden="true"></i>
            <span id="num-items-in-cart">1</span>
          </a>
        </div>
      </div>
    </div>
  </div>
</nav>
{% endblock %}
{% block content %}
<!-- Course Description Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">{{ course.dept }} {{ course.catalog_number }} - {{ course.title }}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <ul class="course-details">
          <li class="course-sections">Sections: L01, P01</li>
          <li class="course-meetings">Meetings: T Th 1:30 PM - 2:50 PM</li>
          <li class="course-location">Location: Friend Center 101</li>
        </ul>
        <p class="course-description">
          {{ course.description }}
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<div id="course-page-content" class="row" ng-init="getReviews()">
  <div class="col-md-2">
    {% raw %}
    <div class="return-link">
      <a href="{{ returnURL }}" target="_self">
        <span><i class="fa fa-angle-left" aria-hidden="true"></i></span>Back to search results
      </a>
    </div>
    {% endraw %}
  </div>
  <div class="col-md-8">
    <div class="course-banner" data-aos="zoom-in" data-aos-once="true" ng-non-bindable>
      <div class="row">
        <div class="card bg-clear">
          <h3 class="card-title"><a href="#myModal" data-toggle="modal">{{ course.dept }} {{ course.catalog_number }} - {{ course.title }}</a></h3>
          <div class="course-instructors">
            {% for instructor in course.instructors %}
              <span>{{ instructor.first_name }} {{ instructor.last_name }}</span>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
    {% raw %}

    <div class="row reviews-summary" data-aos="zoom-in" data-aos-once="true">
      <div class="col-sm-6 rating-display">
        <div class="rating-lg-average">
          {{ selectedTerm.length > 0 ? terms[selectedTerm]['average_rating'] : "0.0" }}
        </div>
        <span class="rating-description" ng-if="selectedTerm.length > 0">
          based on
          <span class="rating-total">
            {{ terms[selectedTerm]['reviews'].length }}</span> reviews
        </span>
        <span class="rating-description" ng-if="selectedTerm.length <= 0">
          Be the first to write a review!
        </span>
      </div>
      <div class="col-sm-6">
        <!-- rating-bars -->
        <div class="initial-rating">
          <span id="star1"><i class="fa fa-lg fa-3x fa-star" aria-hidden="true"></i></span>
          <span id="star2"><i class="fa fa-lg fa-3x fa-star" aria-hidden="true"></i></span>
          <span id="star3"><i class="fa fa-lg fa-3x fa-star" aria-hidden="true"></i></span>
          <span id="star4"><i class="fa fa-lg fa-3x fa-star" aria-hidden="true"></i></span>
          <span id="star5"><i class="fa fa-lg fa-3x fa-star" aria-hidden="true"></i></span>
          <div class="initial-rating-message">Rate this course</div>
        </div>
        <div class="rating-bars" style="display: none;">
          <div class="row">
            <div class="rating-num">5</div>
            <div class="star-container"><i class="rating-star fa fa-star" aria-hidden="true"></i></div>
            <div class="rating-bar">
              <div class="rating-bar-inner"></div>
            </div>
          </div>
          <div class="row">
            <div class="rating-num">4</div>
            <div class="star-container"><i class="rating-star fa fa-star" aria-hidden="true"></i></div>
            <div class="rating-bar">
              <div class="rating-bar-inner"></div>
            </div>
          </div>
          <div class="row">
            <div class="rating-num">3</div>
            <div class="star-container"><i class="rating-star fa fa-star" aria-hidden="true"></i></div>
            <div class="rating-bar">
              <div class="rating-bar-inner"></div>
            </div>
          </div>
          <div class="row">
            <div class="rating-num">2</div>
            <div class="star-container"><i class="rating-star fa fa-star" aria-hidden="true"></i></div>
            <div class="rating-bar">
              <div class="rating-bar-inner"></div>
            </div>
          </div>
          <div class="row">
            <div class="rating-num">1</div>
            <div class="star-container"><i class="rating-star fa fa-star" aria-hidden="true"></i></div>
            <div class="rating-bar">
              <div class="rating-bar-inner"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="terms" data-aos="zoom-in" data-aos-offset="20" data-aos-once="true" ng-if="selectedTerm.length > 0">
      <ul class="nav nav-tabs d-flex justify-content-center">
        <li class="nav-item" ng-repeat="(key, value) in terms">
          <a class="nav-link" id="{{ key }}" ng-class="{ active: key == selectedTerm}" ng-click="getCourseData(key)">
            {{ value['term_string'] }}</a>
        </li>
      </ul>
    </div>
    <!-- Review Section -->
    <div class="reviews" data-aos="zoom-in" data-aos-offset="20" data-aos-once="true">
      <div class="reviews-header">
        <div class="reviews-title">
          <h4>Student Reviews</h4>
        </div>
        <a class="btn btn-primary">Write a Review</a>
        <div class="reviews-sort" ng-if="selectedTerm.length > 0">
          <span>Sort by:</span>
          <select class="sort-options">
            <option value="recent">Most recent</option>
            <option value="positive">Most positive</option>
            <option value="negative">Most negative</option>
            <option value="upvotes">Most upvotes</option>
          </select>
        </div>
      </div>
      <div class="no-reviews" ng-if="selectedTerm.length <= 0">
        <p>There are no student reviews yet.</p>
      </div>
      <div class="reviews-listing" ng-if="selectedTerm.length > 0">
        <div class="row" data-aos="flip-right" data-aos-offset="20" data-aos-once="true" ng-repeat="review in reviews">
          <blockquote class="blockquote">
            <p>{{ review.student_advice }}</p>
          </blockquote>
          <div class="like">
            <div class="sentiment">
              <span><i class="fa fa-lg fa-3x fa-meh-o fa-fw" aria-hidden="true"></i></span>
            </div>
            <div class="thumbs-up">
              <span><i class="fa fa-lg fa-2x fa-thumbs-up" aria-hidden="true"></i></span>
              <span class="num-likes">3</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    <nav class="page-navigation" aria-label="Page navigation">
      <ul class="pagination">
        <li class="page-item" ng-if="pages >= 1" ng-class="{ disabled: currentPage <= 1 }"><a class="page-link review-link" ng-click="getReviewsForPage($event)" onclick="scrollToReviewsTop()">Previous</a></li>
        <li class="page-item" ng-if="pages > 1 && pages < 10" ng-repeat="(pageNum, isActive) in pageLinks track by $index" ng-class="{ active: isActive}"><a class="page-link review-link" ng-click="getReviewsForPage($event)" onclick="scrollToReviewsTop()">{{ pageNum + 1 }}</a></li>

        <li class="page-item" ng-if="pages >= 10 && currentPage < 5 && pageNum < 5" ng-repeat="(pageNum, isActive) in pageLinks track by $index" ng-class="{ active: isActive }"><a class="page-link review-link" ng-click="getReviewsForPage($event)" onclick="scrollToReviewsTop()">{{ pageNum + 1 }}</a></li>
        <li class="page-item disabled" ng-if="pages >= 10 && currentPage < 5"><a class="page-link review-link">...</a></li>
        <li class="page-item" ng-if="pages >= 10 && currentPage < 5"><a class="page-link review-link" ng-click="getReviewsForPage($event)" onclick="scrollToReviewsTop()">{{ pages }}</a></li>

        <li class="page-item" ng-if="pages >= 10 && currentPage >= 5 && currentPage <= pages-4"><a class="page-link review-link" ng-click="getReviewsForPage($event)" onclick="scrollToReviewsTop()">1</a></li>
        <li class="page-item disabled" ng-if="pages >= 10 && currentPage >= 5 && currentPage <= pages-4"><a class="page-link review-link">...</a></li>
        <li class="page-item" ng-if="pages >= 10 && currentPage >= 5 && currentPage <= pages-4"><a class="page-link review-link" ng-click="getReviewsForPage($event)" onclick="scrollToReviewsTop()">{{ currentPage - 1}}</a></li>
        <li class="page-item active" ng-if="pages >= 10 && currentPage >= 5 && currentPage <= pages-4"><a class="page-link review-link" ng-click="getReviewsForPage($event)" onclick="scrollToReviewsTop()">{{ currentPage }}</a></li>
        <li class="page-item" ng-if="pages >= 10 && currentPage >= 5 && currentPage <= pages-4"><a class="page-link review-link" ng-click="getReviewsForPage($event)" onclick="scrollToReviewsTop()">{{ currentPage + 1}}</a></li>
        <li class="page-item disabled" ng-if="pages >= 10 && currentPage >= 5 && currentPage <= pages-4"><a class="page-link review-link">...</a></li>
        <li class="page-item" ng-if="pages >= 10 && currentPage >= 5 && currentPage <= pages-4"><a class="page-link review-link" ng-click="getReviewsForPage($event)" onclick="scrollToReviewsTop()">{{ pages }}</a></li>

        <li class="page-item" ng-if="pages >= 10 && currentPage > pages-4"><a class="page-link review-link" ng-click="getReviewsForPage($event)" onclick="scrollToReviewsTop()">1</a></li>
        <li class="page-item disabled" ng-if="pages >= 10 && currentPage > pages-4"><a class="page-link review-link">...</a></li>
        <li class="page-item" ng-if="pages >= 10 && currentPage > pages-4 && pageNum >= pages-5" ng-repeat="(pageNum, isActive) in pageLinks track by $index" ng-class="{ active: isActive }"><a class="page-link review-link" ng-click="getReviewsForPage($event)" onclick="scrollToReviewsTop()">{{ pageNum + 1 }}</a></li>

        <li class="page-item" ng-if="pages >= 1" ng-class="{ disabled: currentPage >= pages }"><a class="page-link review-link" ng-click="getReviewsForPage($event)" onclick="scrollToReviewsTop()">Next</a></li>
      </ul>
    </nav>
    {% endraw %}
  </div>
  <div class="col-md-2">
    <div class="tool-panel" data-aos="zoom-in" data-aos-once="true">
      <div class="card">
        <a href="/rant" class="btn disabled rant-space-button">
          <img class="card-img-top" src="/static/icons/svg/door.svg" alt="Card image cap">
        </a>
        <div class="card-block">
          <h7 class="card-subtitle">Enter Rant Space</h7>
        </div>
      </div>
      <div class="card">
        <div class="card-block">
          <h7 class="card-subtitle"></h7>
        </div>
        <a href="/cart" class="btn add-to-cart-button" target="_self">
          <i class="fa fa-shopping-cart fa-lg" aria-hidden="true"></i>
          <span>Add to Cart</span>
        </a>
      </div>
    </div>
  </div>
</div>
<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.4.9/angular.min.js"></script>
<script src="/static/js/course_controller.js"></script>
{% endblock %}
